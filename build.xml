<?xml version="1.0"?> 
<project name="uebung0 demo project" default="jar">
	<!-- 
	
		THERE ARE SEVERAL TODO's, which you should integrate
	
	-->

	
	<!-- Define Properties -->
    <property name="src.java" value="${basedir}/src"/>		<!-- java sources -->
    <property name="src.junit" value="${basedir}/test"/>	<!-- junit test sources -->
	
	<property name="libs" value="${basedir}/libs"/> 		<!-- libraries folder for external libraries, e.g. junit -->
    
    <property name="target" value="${basedir}/build" />		<!-- target folder -->
    <property name="target.java" value="${target}/java"/>	<!-- target folder for java classes -->
    <property name="target.junit" value="${target}/junit"/>	<!-- target folder for junit test classes -->
    <property name="target.testreports" value="${target}/testreports"/>	<!-- target folder for reports, which are generated by the test target -->
    <property name="target.jar" value="${target}/jar"/>					<!-- target folder for jar archive, which are generated by the jar target -->

    <!-- alternative include a properties file to keep the build file clean and structured  -->
	<!-- <property file="build.properties" /> -->
	

	<!-- define external libs, like junit -->
	<path id="externalLibs">
		<pathelement location="${libs}/junit-4.10.jar" />
		<!--<pathelement location="${libs}/xxx.jar" />-->
	</path>

	<!-- define fileset for source code -->
	<fileset id="javaCode" dir="${src.java}">
		<!-- 
			TODO: include the needed source files by pattern, e.g. all *.java
		-->
		<include name="**/*.java"/>
	</fileset>

	<!-- define fileset for test code -->
	<fileset id="junitTestCode" dir="${src.junit}">
		<!-- 
			TODO: include the needed source files by pattern, e.g. all *Test.java
		-->
		<include name="**/*Test.java"/>
		
	</fileset>
	
	<!-- define fileset for FAIL test code -->
	<fileset id="junitTestCodeFail" dir="${src.junit}">
		<!-- 
			TODO: include the needed source files by pattern, e.g. all Test Files which named *Fail.java
		-->
		<include name="**/*Fail.java"/>
		
	</fileset>
	
	<!-- clean -->
    <target name="clean">
        <delete dir="build"/>
    </target>
	
	<!-- prepare everything -->
    <target name="prepare" description="prepare folder structure for compiling classes and generating documentation">
		<mkdir dir="${target.java}" />
		<mkdir dir="${target.junit}" />
		<mkdir dir="${target.jar}" />
    </target>

	<target name="compile" depends="prepare" description="compiles java sources">
		<!-- compile java sources -->
		<javac srcdir="${src.java}" destdir="${target.java}" includeantruntime="false" />
		<!-- compile junit test sources -->
		<javac srcdir="${src.junit}" destdir="${target.junit}" includeantruntime="false">
			<classpath>
				<pathelement location="${target.java}"/>
				<path refid="externalLibs" /> <!-- are needed because junit is not standard implemented to jdk -->
			</classpath>
		</javac>
	</target>

	<!-- run all tests and complete script will halt on failure -->
	<target name="test" depends="compile" description="testing the java source code" >
		<!-- 
			TODO: please use "junitTestCode" fileset for integrating test cases, which should fail 
		-->
		<delete dir="${target.testreports}"/>
		<mkdir dir="${target.testreports}"/>
		
		<junit printsummary="yes" haltonfailure="yes">
			<classpath>
				<pathelement location="${target.java}"/>
				<pathelement location="${target.junit}"/>
				<path refid="externalLibs"/>
			</classpath>
			
			<batchtest todir="${target.testreports}">
				<fileset refid="junitTestCode"/>
			</batchtest>
			<formatter type="plain"/>
		</junit>
		
	</target>
	

	<!-- run tests (which should fail in these lab case) and complete script will halt on failure -->
	<target name="test-fail" depends="clean,compile" description="testing the java source code" >
		<!-- 
			TODO: please use "junitTestCodeFail" fileset for integrating test cases, which should fail 
		-->
		
		<delete dir="${target.testreports}"/>
				<mkdir dir="${target.testreports}"/>
				
				<junit printsummary="yes" haltonfailure="yes">
					<classpath>
						<pathelement location="${target.java}"/>
						<pathelement location="${target.junit}"/>
						<path refid="externalLibs"/>
					</classpath>
					
					<batchtest todir="${target.testreports}">
						<fileset refid="junitTestCodeFail"/>
					</batchtest>
					<formatter type="plain"/>
				</junit>
	</target>
	

	<!-- create jar file for later use -->
    <target name="jar" depends="test" description="creates jar archive for deployement">
        <mkdir dir="build/jar"/>
        <jar destfile="build/jar/point-petrovak15.jar" >
            <manifest>
                <attribute name="Main-Class" value="at.fhj.itm.petrovak15.EntryPoint"/>
            </manifest>
			<fileset dir="${target.java}">
				<include name="**/*.class" />
			</fileset>
        </jar>
    </target>
	
	<!-- DOESN'T CREATE jar file, because a test will fail and no jar will be created -->
    <target name="jar-fail" depends="test-fail, jar" description="creates jar archive for deployement">
    </target>

    <target name="run" depends="jar">
        <echo message="Attempting to run!" />
        <java jar="build/jar/point-petrovak15.jar" output="results.txt" fork="true" >
    		<arg line="dist 0 0 7 7 " />	
    	</java>
    </target>

</project>

